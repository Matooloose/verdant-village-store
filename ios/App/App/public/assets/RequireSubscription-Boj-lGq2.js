import{a as p,u as f,U as h,h as b,j as t,s as v}from"./index-cM6hlhfj.js";import{r as u}from"./vendor-Gsz-jK4b.js";import"./ui-CAx9UBAP.js";const C=({children:l})=>{const{user:i}=p(),r=f(),e=h(),{toast:o}=b(),[d,c]=u.useState(!0);return u.useEffect(()=>{let a=!0;return(async()=>{if(!i){r("/login",{state:{next:e.pathname}});return}try{const{data:s,error:n}=await v.rpc("has_active_subscription",{_user_id:i.id});if(n)throw n;if(!(s===!0||s==="t"||s===1||s==="true")){const m=`${e.pathname}${e.search||""}${e.hash||""}`;r(`/subscriptions?next=${encodeURIComponent(m)}`),a&&c(!1);return}}catch(s){console.error("Subscription check failed",s),o({title:"Error",description:"Failed to verify subscription. Please try again.",variant:"destructive"});const n=`${e.pathname}${e.search||""}${e.hash||""}`;r(`/subscriptions?next=${encodeURIComponent(n)}`)}finally{a&&c(!1)}})(),()=>{a=!1}},[i,r,e.pathname,e.search,e.hash,o]),d?t.jsxDEV("div",{className:"min-h-screen bg-background flex items-center justify-center",children:t.jsxDEV("div",{className:"text-center",children:[t.jsxDEV("div",{className:"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/components/RequireSubscription.tsx",lineNumber:54,columnNumber:11},void 0),t.jsxDEV("p",{className:"text-muted-foreground",children:"Checking subscription..."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/components/RequireSubscription.tsx",lineNumber:55,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/components/RequireSubscription.tsx",lineNumber:53,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/components/RequireSubscription.tsx",lineNumber:52,columnNumber:7},void 0):t.jsxDEV(t.Fragment,{children:l},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/components/RequireSubscription.tsx",lineNumber:61,columnNumber:10},void 0)};export{C as default};
