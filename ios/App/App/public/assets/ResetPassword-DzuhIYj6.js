import{h as y,u as _,s as b,j as e,C as S,c as L,d as B,e as F,B as u}from"./index-cM6hlhfj.js";import{r as n}from"./vendor-Gsz-jK4b.js";import{I as D}from"./input-lvqziEey.js";import{L as k}from"./label-D9QexlfX.js";import"./ui-CAx9UBAP.js";const M=()=>{const[i,P]=n.useState(""),[m,C]=n.useState(""),[f,v]=n.useState(!1),[R,d]=n.useState(!1),[p,E]=n.useState(null),{toast:l}=y(),c=_();n.useEffect(()=>{const a=()=>{const r=new URL(window.location.href).searchParams,o=r.get("access_token"),t=r.get("refresh_token");if(o&&t)return{access_token:o,refresh_token:t};const N=r.get("error")||null,g=r.get("error_code")||null,U=r.get("error_description")||null;if(N||g)return{error:N,error_code:g,error_description:U};if(window.location.hash){const V=window.location.hash.replace(/^#/,""),x=new URLSearchParams(V),h=x.get("access_token"),w=x.get("refresh_token");if(h&&w)return{access_token:h,refresh_token:w}}return null};(async()=>{const s=a();if(s){if("error"in s||"error_code"in s){const r=s.error_description||"The reset link is invalid or has expired.";E(r??"The reset link is invalid or has expired."),d(!0);return}try{const r={access_token:s.access_token,refresh_token:s.refresh_token},{error:o}=await b.auth.setSession(r);if(o){console.error("setSession error on reset callback",o),l({title:"Error",description:o.message,variant:"destructive"});return}try{const t=new URL(window.location.href);t.hash="",t.searchParams.delete("access_token"),t.searchParams.delete("refresh_token"),window.history.replaceState({},"",t.toString())}catch{}d(!0);return}catch(r){console.error("Failed to set session from reset link",r),l({title:"Error",description:"Failed to process reset link",variant:"destructive"});return}}d(!0)})()},[l]);const j=async a=>{if(a.preventDefault(),i!==m){l({title:"Error",description:"Passwords do not match.",variant:"destructive"});return}v(!0);try{const{error:s}=await b.auth.updateUser({password:i});if(s)throw s;l({title:"Password Reset Successful",description:"Your password has been updated. You can now sign in."}),c("/login")}catch(s){l({title:"Error",description:s instanceof Error?s.message:"Failed to reset password",variant:"destructive"})}finally{v(!1)}};return R?e.jsxDEV("div",{className:"min-h-screen flex items-center justify-center py-12 px-4",children:e.jsxDEV("div",{className:"w-full max-w-md mx-auto",children:[e.jsxDEV("div",{className:"text-center mb-6",children:[e.jsxDEV("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-primary to-primary-light rounded-full flex items-center justify-center mb-2",children:e.jsxDEV("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"text-primary-foreground",children:e.jsxDEV("path",{d:"M12 2C12 2 16 6 12 10C8 14 4 12 4 12C4 12 6 8 12 2Z",fill:"currentColor"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:142,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:141,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:139,columnNumber:11},void 0),e.jsxDEV("h1",{className:"text-2xl font-bold",children:"FarmersBracket"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:145,columnNumber:11},void 0),e.jsxDEV("p",{className:"text-muted-foreground",children:"Buy fresh. Support local farmers."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:146,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:138,columnNumber:9},void 0),e.jsxDEV(S,{children:[e.jsxDEV(L,{children:e.jsxDEV(B,{children:"Reset Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:151,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:150,columnNumber:11},void 0),e.jsxDEV(F,{children:p?e.jsxDEV("div",{className:"space-y-4 text-center",children:[e.jsxDEV("p",{className:"text-red-600",children:p},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:156,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(u,{onClick:()=>c("/forgot-password"),className:"flex-1",children:"Request new link"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:158,columnNumber:19},void 0),e.jsxDEV(u,{variant:"secondary",onClick:()=>c("/login"),children:"Back to login"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:159,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:157,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:155,columnNumber:15},void 0):e.jsxDEV("form",{onSubmit:j,className:"space-y-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(k,{htmlFor:"password",children:"New Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:165,columnNumber:19},void 0),e.jsxDEV(D,{id:"password",type:"password",value:i,onChange:a=>P(a.target.value),required:!0},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:166,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:164,columnNumber:17},void 0),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(k,{htmlFor:"confirmPassword",children:"Confirm Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:169,columnNumber:19},void 0),e.jsxDEV(D,{id:"confirmPassword",type:"password",value:m,onChange:a=>C(a.target.value),required:!0},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:170,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:168,columnNumber:17},void 0),e.jsxDEV(u,{type:"submit",className:"w-full",disabled:f,children:f?"Resetting...":"Reset Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:172,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:163,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:153,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:149,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:136,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:135,columnNumber:5},void 0):e.jsxDEV("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:127,columnNumber:11},void 0),e.jsxDEV("p",{className:"text-muted-foreground",children:"Processing reset link..."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:128,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:126,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/ResetPassword.tsx",lineNumber:125,columnNumber:7},void 0)};export{M as default};
