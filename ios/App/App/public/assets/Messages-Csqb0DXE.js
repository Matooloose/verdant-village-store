import{g as B,x as xe,u as De,a as he,h as Ce,b as Ee,s as m,j as e,B as u,C as y,c as ke,d as Me,q as je,e as S,w as se,S as re,M as ae,D as Ve,l as Ue,m as _e,n as we,o as ye,A as Se,f as Te}from"./index-cM6hlhfj.js";import{r as i}from"./vendor-Gsz-jK4b.js";import{I as le}from"./input-lvqziEey.js";import{S as qe}from"./scroll-area-D8UjMpJ0.js";import{T as Le,a as $e,b as T}from"./tabs-BISYs8ua.js";import{A as F}from"./arrow-left-DjF5G2qn.js";import{L as Ae}from"./lock-D5uPprrW.js";import{C as H}from"./crown-BG_BCAQs.js";import{P as ze}from"./phone-CQIu9Kpr.js";import{V as Re}from"./video-8F428Msy.js";import{S as Pe}from"./send-BzxOigAI.js";import{T as Fe}from"./trash-2-aUnW5rwe.js";import{c as He}from"./constructFrom-rJN6zrQ_.js";import{s as te,f as O}from"./format-CF2rwVyB.js";import{s as Oe}from"./subDays-Ch0RWqvG.js";import"./ui-CAx9UBAP.js";import"./index-BdQq_4o_.js";import"./addDays-DUX3p28w.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=B("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=B("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=B("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);function ie(c){return He(c,Date.now())}function ne(c,k){const I=te(c),Y=te(k);return+I==+Y}function Qe(c){return ne(c,ie(c))}function Ge(c){return ne(c,Oe(ie(c),1))}const vs=()=>{const c=i.useRef(null),k=i.useRef(null),{cartItems:I,getTotalItems:Y}=xe(),v=De(),{user:r}=he(),{toast:q}=Ce(),{addNotification:b,notifications:M}=Ee(),[x,de]=i.useState(!1),[L,oe]=i.useState(!0),[$,Q]=i.useState([]),[D,A]=i.useState(""),[l,G]=i.useState(null),[p,K]=i.useState(!0),[Ke,me]=i.useState([]),[ue,j]=i.useState([]),[z,ce]=i.useState(""),[We,fe]=i.useState(null),[V,ge]=i.useState("all"),[Ne,R]=i.useState(!1);i.useEffect(()=>{var s;(s=k.current)==null||s.scrollIntoView({behavior:"smooth"})},[$]);const h=i.useCallback(async()=>{if(r)try{const{data:s,error:a}=await m.rpc("has_active_subscription",{_user_id:r.id});if(a)throw a;de(s)}catch(s){console.error("Error checking subscription:",s)}finally{oe(!1)}},[r]),f=i.useCallback(async()=>{if(r)try{const{data:s,error:a}=await m.from("chats").select("*").or(`sender_id.eq.${r.id},receiver_id.eq.${r.id}`).order("created_at",{ascending:!1});if(a)throw a;if(!s||s.length===0){j([]);return}const n=[...new Set(s.map(t=>t.sender_id===r.id?t.receiver_id:t.sender_id).filter(Boolean))];if(n.length===0){j([]);return}const{data:g,error:U}=await m.from("profiles").select("id, name, image_url").in("id",n),{data:N,error:pe}=await m.from("user_roles").select("user_id, role").in("user_id",n),_=new Map;N&&!pe&&N.forEach(t=>{(!_.has(t.user_id)||t.role==="admin")&&_.set(t.user_id,t.role)});const{data:P,error:Je}=await m.from("farms").select("farmer_id").in("farmer_id",n),ee=new Set((P==null?void 0:P.map(t=>t.farmer_id))||[]),w=new Map;g&&!U&&g.forEach(t=>{const d=_.get(t.id);let o="customer";d==="admin"?o="admin":(d==="farmer"||ee.has(t.id))&&(o="farmer"),w.set(t.id,{...t,user_type:o})}),n.forEach(t=>{if(!w.has(t)){const d=_.get(t);let o="customer";d==="admin"?o="admin":(d==="farmer"||ee.has(t))&&(o="farmer"),w.set(t,{id:t,name:"User",image_url:null,user_type:o})}});const C=new Map;s.forEach(t=>{const d=t.sender_id===r.id?t.receiver_id:t.sender_id,o=w.get(d);if(!(!o||!d))if(!C.has(d))C.set(d,{id:d,other_user:{id:o.id,name:o.name||"User",image_url:o.image_url,user_type:o.user_type||"customer",is_online:!1},last_message:t,unread_count:0,updated_at:t.created_at});else{const E=C.get(d);new Date(t.created_at)>new Date(E.last_message.created_at)&&(E.last_message=t,E.updated_at=t.created_at)}});for(const[t,d]of C){const{data:o,error:E}=await m.from("chats").select("id").eq("sender_id",t).eq("receiver_id",r.id).eq("is_read",!1);!E&&o&&(d.unread_count=o.length)}const be=Array.from(C.values()).sort((t,d)=>new Date(d.updated_at).getTime()-new Date(t.updated_at).getTime());j(be)}catch(s){console.error("Error fetching conversations:",s),j([])}},[r]);i.useEffect(()=>{if(!r||!l)return;const s=m.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chats",filter:`or(and(sender_id.eq.${r.id},receiver_id.eq.${l.id}),and(sender_id.eq.${l.id},receiver_id.eq.${r.id}))`},a=>{console.log("New message received:",a),Q(n=>[...n,a.new]),f(),a.new.sender_id!==r.id&&b({title:"New Message",message:`New message from ${l.name||"user"}`,type:"farmer",read:!1})}).subscribe();return fe(s),()=>{s&&m.removeChannel(s)}},[r,l,b,f]),i.useEffect(()=>{if(!r)return;const s=m.channel("conversations").on("postgres_changes",{event:"INSERT",schema:"public",table:"chats",filter:`or(sender_id.eq.${r.id},receiver_id.eq.${r.id})`},()=>{f()}).subscribe();return()=>{s&&m.removeChannel(s)}},[r,f]),i.useCallback(async()=>{if(r)try{const{data:s,error:a}=await m.from("chats").select("sender_id,receiver_id").or(`sender_id.eq.${r.id},receiver_id.eq.${r.id}`);if(a)throw a;const n=Array.from(new Set((s||[]).flatMap(N=>[N.sender_id,N.receiver_id]).filter(N=>N&&N!==r.id)));if(n.length===0)return;const{data:g,error:U}=await m.from("profiles").select("id, name, image_url").in("id",n);if(U)throw U;me(g||[])}catch(s){console.error("Error fetching user list:",s)}},[r]);const W=i.useCallback(async s=>{if(!(!r||!s))try{const{data:a,error:n}=await m.from("chats").select("*").or(`and(sender_id.eq.${r.id},receiver_id.eq.${s}),and(sender_id.eq.${s},receiver_id.eq.${r.id})`).order("created_at",{ascending:!0});if(n)throw n;Q(a||[]);const{error:g}=await m.from("chats").update({is_read:!0}).eq("sender_id",s).eq("receiver_id",r.id).eq("is_read",!1);g?console.error("Error marking messages as read:",g):f()}catch(a){console.error("Error fetching messages:",a)}},[r,f]);i.useEffect(()=>{!p&&l&&M&&M.length>0&&M.forEach(s=>{s.type==="farmer"&&s.message&&s.message.indexOf("new message from "+l.name)!==-1&&!s.read&&typeof s.id<"u"&&typeof s.read<"u"&&typeof window<"u"&&typeof b=="function"&&b({...s,read:!0})})},[p,l,M,b]);const J=i.useCallback(async()=>{if(!D.trim()||!r||!l)return;const s=D.trim();A("");try{const{error:a}=await m.from("chats").insert({sender_id:r.id,receiver_id:l.id,message:s,is_read:!1});if(a)throw a;f(),q({title:"Message sent!",description:`Your message has been sent to ${l.name||"user"}.`})}catch(a){console.error("Error sending message:",a),A(s),q({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}},[D,r,l,q,f]);i.useEffect(()=>{r&&h()},[r,h]),i.useEffect(()=>{L||x||v("/subscriptions")},[L,x,v]),i.useEffect(()=>{const s=()=>{h()},a=n=>{h()};return window.addEventListener("storage",s),window.addEventListener("subscription:changed",a),()=>{window.removeEventListener("storage",s),window.removeEventListener("subscription:changed",a)}},[h]),i.useEffect(()=>{r&&f()},[r,f]),i.useEffect(()=>{x&&l&&W(l.id)},[x,l,W]);const ve=s=>{const a=new Date(s);return Qe(a)?O(a,"HH:mm"):Ge(a)?"Yesterday":O(a,"MMM d")},X=s=>{switch(s){case"farmer":return e.jsxDEV(H,{className:"h-3 w-3 text-green-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:524,columnNumber:16},void 0);case"admin":return e.jsxDEV(H,{className:"h-3 w-3 text-blue-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:526,columnNumber:16},void 0);default:return null}},Z=ue.filter(s=>{var n,g;const a=((n=s.other_user.name)==null?void 0:n.toLowerCase().includes(z.toLowerCase()))||((g=s.last_message)==null?void 0:g.message.toLowerCase().includes(z.toLowerCase()));switch(V!=="all"&&console.log("Filtering conversation:",{user:s.other_user.name,user_type:s.other_user.user_type,unread_count:s.unread_count,activeTab:V}),V){case"unread":return a&&s.unread_count>0;case"farmers":return a&&s.other_user.user_type==="farmer";case"support":return a&&s.other_user.user_type==="admin";default:return a}});return L?e.jsxDEV("div",{className:"min-h-screen bg-background",children:[e.jsxDEV("header",{className:"page-topbar sticky top-0 z-50 bg-card border-b",children:e.jsxDEV("div",{className:"container mx-auto px-4 py-3",children:e.jsxDEV("div",{className:"flex items-center",children:[e.jsxDEV(u,{variant:"ghost",size:"sm",onClick:()=>v(-1),children:e.jsxDEV(F,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:566,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:565,columnNumber:15},void 0),e.jsxDEV("h1",{className:"ml-2 text-lg font-semibold",children:"Messages"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:568,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:564,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:563,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:562,columnNumber:5},void 0),e.jsxDEV("main",{className:"container mx-auto px-4 py-6",children:e.jsxDEV("div",{className:"space-y-4 animate-pulse",children:[e.jsxDEV("div",{className:"h-32 bg-muted rounded-lg"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:574,columnNumber:13},void 0),e.jsxDEV("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxDEV("div",{className:"h-16 bg-muted rounded-lg"},s,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:577,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:575,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:573,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:572,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:561,columnNumber:7},void 0):x?e.jsxDEV("div",{className:"min-h-screen bg-background",children:[e.jsxDEV("header",{className:"page-topbar sticky top-0 z-50 bg-card border-b shadow-sm",children:e.jsxDEV("div",{className:"container mx-auto px-4 py-3",children:e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV(u,{variant:"ghost",size:"sm",onClick:()=>{p?v(-1):(K(!0),G(null))},children:e.jsxDEV(F,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:656,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:642,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-lg font-semibold",children:!p&&l?l.name||"User":"Messages"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:659,columnNumber:17},void 0),!p&&(l==null?void 0:l.user_type)&&e.jsxDEV("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[X(l.user_type),l.user_type==="farmer"?"Farmer":l.user_type==="admin"?"Support":"User",l.is_online&&e.jsxDEV(se,{variant:"secondary",className:"text-xs ml-2",children:"Online"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:668,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:663,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:658,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:641,columnNumber:13},void 0),!p&&l&&e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV(u,{variant:"ghost",size:"sm",children:e.jsxDEV(ze,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:678,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:677,columnNumber:17},void 0),e.jsxDEV(u,{variant:"ghost",size:"sm",children:e.jsxDEV(Re,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:681,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:680,columnNumber:17},void 0),e.jsxDEV(u,{variant:"ghost",size:"sm",onClick:()=>R(!0),children:e.jsxDEV(Ie,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:684,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:683,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:676,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:640,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:639,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:638,columnNumber:3},void 0),e.jsxDEV("main",{className:"container mx-auto px-4 py-6 max-w-4xl pb-20",children:p?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mb-6 space-y-4",children:[e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(re,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:698,columnNumber:17},void 0),e.jsxDEV(le,{placeholder:"Search conversations...",value:z,onChange:s=>ce(s.target.value),className:"pl-10"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:699,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:697,columnNumber:15},void 0),e.jsxDEV(Le,{value:V,onValueChange:ge,children:e.jsxDEV($e,{className:"grid w-full grid-cols-4",children:[e.jsxDEV(T,{value:"all",children:"All"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:709,columnNumber:19},void 0),e.jsxDEV(T,{value:"unread",children:"Unread"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:710,columnNumber:19},void 0),e.jsxDEV(T,{value:"farmers",children:"Farmers"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:711,columnNumber:19},void 0),e.jsxDEV(T,{value:"support",children:"Support"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:712,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:708,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:707,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:696,columnNumber:13},void 0),e.jsxDEV("div",{className:"space-y-2",children:Z.length===0?e.jsxDEV(y,{children:e.jsxDEV(S,{className:"p-6 text-center",children:[e.jsxDEV(ae,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:722,columnNumber:21},void 0),e.jsxDEV("h3",{className:"text-lg font-medium mb-2",children:"No conversations yet"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:723,columnNumber:21},void 0),e.jsxDEV("p",{className:"text-muted-foreground mb-4",children:"Start chatting with farmers to get the conversation going!"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:724,columnNumber:21},void 0),e.jsxDEV(u,{onClick:()=>v("/browse-products"),children:[e.jsxDEV(re,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:728,columnNumber:23},void 0),"Browse Products"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:727,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:721,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:720,columnNumber:17},void 0):Z.map(s=>{var a;return e.jsxDEV(y,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{G(s.other_user),K(!1)},children:e.jsxDEV(S,{className:"p-4",children:e.jsxDEV("div",{className:"flex items-center gap-3",children:[s.other_user.image_url?e.jsxDEV("img",{src:s.other_user.image_url,alt:s.other_user.name||"User",className:"w-12 h-12 rounded-full object-cover"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:746,columnNumber:27},void 0):e.jsxDEV("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center text-lg font-bold",children:((a=s.other_user.name)==null?void 0:a[0])||"U"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:752,columnNumber:27},void 0),e.jsxDEV("div",{className:"flex-1 min-w-0",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("p",{className:"font-medium text-sm truncate",children:s.other_user.name||"User"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:760,columnNumber:31},void 0),X(s.other_user.user_type)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:759,columnNumber:29},void 0),e.jsxDEV("div",{className:"flex items-center gap-2",children:[s.last_message&&e.jsxDEV("span",{className:"text-xs text-muted-foreground",children:ve(s.last_message.created_at)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:767,columnNumber:33},void 0),s.unread_count>0&&e.jsxDEV(se,{className:"bg-primary text-primary-foreground",children:s.unread_count},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:772,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:765,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:758,columnNumber:27},void 0),s.last_message&&e.jsxDEV("p",{className:"text-xs text-muted-foreground truncate mt-1",children:[s.last_message.message.slice(0,60),s.last_message.message.length>60?"...":""]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:779,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:757,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:744,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:743,columnNumber:21},void 0)},s.id,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:735,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:718,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:694,columnNumber:11},void 0):e.jsxDEV(e.Fragment,{children:e.jsxDEV(y,{className:"h-[600px] flex flex-col",children:e.jsxDEV(S,{className:"flex-1 flex flex-col p-0",children:[e.jsxDEV(qe,{className:"flex-1 p-4",children:e.jsxDEV("div",{className:"space-y-4",children:[$.length===0?e.jsxDEV("div",{className:"text-center text-muted-foreground py-8",children:[e.jsxDEV(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:802,columnNumber:25},void 0),e.jsxDEV("p",{children:"No messages yet. Start a conversation!"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:803,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:801,columnNumber:23},void 0):$.filter(s=>s.sender_id===(l==null?void 0:l.id)&&s.receiver_id===(r==null?void 0:r.id)||s.sender_id===(r==null?void 0:r.id)&&s.receiver_id===(l==null?void 0:l.id)).map(s=>e.jsxDEV("div",{className:`flex ${s.sender_id===(r==null?void 0:r.id)?"justify-end":"justify-start"}`,children:e.jsxDEV("div",{className:`max-w-[80%] p-3 rounded-lg ${s.sender_id===(r==null?void 0:r.id)?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsxDEV("p",{className:"text-sm",children:s.message},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:823,columnNumber:31},void 0),e.jsxDEV("p",{className:"text-xs opacity-70 mt-1",children:O(new Date(s.created_at),"HH:mm")},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:824,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:816,columnNumber:29},void 0)},s.id,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:812,columnNumber:27},void 0)),e.jsxDEV("div",{ref:k},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:831,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:799,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:798,columnNumber:17},void 0),e.jsxDEV("div",{className:"p-4 border-t",children:e.jsxDEV("div",{className:"flex space-x-2",children:[e.jsxDEV(le,{ref:c,placeholder:"Type your message...",value:D,onChange:s=>A(s.target.value),onKeyPress:s=>s.key==="Enter"&&J(),className:"flex-1"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:838,columnNumber:21},void 0),e.jsxDEV(u,{onClick:J,disabled:!D.trim(),children:e.jsxDEV(Pe,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:847,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:846,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:837,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:836,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:796,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:795,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:793,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:692,columnNumber:7},void 0),e.jsxDEV(Ve,{open:Ne,onOpenChange:R,children:e.jsxDEV(Ue,{children:[e.jsxDEV(_e,{children:[e.jsxDEV(we,{children:"Chat Settings"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:861,columnNumber:13},void 0),e.jsxDEV(ye,{children:["Manage your conversation with ",l==null?void 0:l.name]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:862,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:860,columnNumber:11},void 0),e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV(u,{variant:"outline",className:"w-full justify-start",children:[e.jsxDEV(Ye,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:869,columnNumber:15},void 0),"Pin Conversation"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:868,columnNumber:13},void 0),e.jsxDEV(u,{variant:"outline",className:"w-full justify-start",children:[e.jsxDEV(Be,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:873,columnNumber:15},void 0),"Archive Conversation"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:872,columnNumber:13},void 0),e.jsxDEV(u,{variant:"outline",className:"w-full justify-start text-red-600",children:[e.jsxDEV(Fe,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:877,columnNumber:15},void 0),"Delete Conversation"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:876,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:867,columnNumber:11},void 0),e.jsxDEV(Se,{children:e.jsxDEV(u,{variant:"outline",onClick:()=>R(!1),children:"Close"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:883,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:882,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:859,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:858,columnNumber:7},void 0),e.jsxDEV(Te,{},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:891,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:636,columnNumber:5},void 0):e.jsxDEV("div",{className:"min-h-screen bg-background",children:[e.jsxDEV("header",{className:"page-topbar sticky top-0 z-50 bg-card border-b",children:e.jsxDEV("div",{className:"container mx-auto px-4 py-3",children:e.jsxDEV("div",{className:"flex items-center",children:[e.jsxDEV(u,{variant:"ghost",size:"sm",onClick:()=>v(-1),children:e.jsxDEV(F,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:594,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:593,columnNumber:15},void 0),e.jsxDEV("h1",{className:"ml-2 text-lg font-semibold",children:"Messages"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:596,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:592,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:591,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:590,columnNumber:3},void 0),e.jsxDEV("main",{className:"container mx-auto px-4 py-6 max-w-2xl",children:e.jsxDEV(y,{className:"border-amber-200 bg-amber-50",children:[e.jsxDEV(ke,{children:[e.jsxDEV(Me,{className:"flex items-center text-amber-800",children:[e.jsxDEV(Ae,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:604,columnNumber:17},void 0),"Subscription Required"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:603,columnNumber:15},void 0),e.jsxDEV(je,{className:"text-amber-700",children:"You need an active subscription to access messaging features and chat with farmers."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:607,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:602,columnNumber:13},void 0),e.jsxDEV(S,{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{className:"bg-card p-4 rounded-lg border border-border",children:[e.jsxDEV("h3",{className:"font-medium mb-2",children:"With a subscription, you can:"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:614,columnNumber:19},void 0),e.jsxDEV("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxDEV("li",{children:"• Chat directly with farmers"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:616,columnNumber:21},void 0),e.jsxDEV("li",{children:"• Ask questions about products"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:617,columnNumber:21},void 0),e.jsxDEV("li",{children:"• Get priority support"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:618,columnNumber:21},void 0),e.jsxDEV("li",{children:"• Coordinate delivery details"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:619,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:615,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:613,columnNumber:17},void 0),e.jsxDEV(u,{onClick:()=>v("/subscriptions"),className:"w-full",children:[e.jsxDEV(H,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:623,columnNumber:19},void 0),"View Subscription Plans"]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:622,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:612,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:611,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:601,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:600,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Messages.tsx",lineNumber:589,columnNumber:7},void 0)};export{vs as default};
