import{u as F,a as B,h as M,j as e,C as w,c as y,d as S,q as P,e as I,X as p,B as _,L as A}from"./index-cM6hlhfj.js";import{r as n}from"./vendor-Gsz-jK4b.js";import{I as x}from"./input-lvqziEey.js";import{L as b}from"./label-D9QexlfX.js";import{L as O}from"./leaf-Lr4USLAX.js";import{E as q}from"./eye-off-BHMLpHkS.js";import{E as W}from"./eye-ByvufGnD.js";import{C as D}from"./check-DidQSGY2.js";import"./ui-CAx9UBAP.js";const V="pending_profile",se=()=>{const m=F(),{signUp:h,signIn:u}=B(),{toast:t}=M(),[s,c]=n.useState({username:"",email:"",password:"",confirm:""}),[d,o]=n.useState(!1),[C,k]=n.useState(!1),[g,L]=n.useState(!1),[R,j]=n.useState(null),f=s.password||"",a={length:f.length>=8,uppercase:/[A-Z]/.test(f),number:/\d/.test(f),special:/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(f)},U=Object.values(a).filter(Boolean).length,E=U===4,v=s.password===s.confirm&&s.confirm.length>0,N=r=>{c(l=>({...l,[r.target.name]:r.target.value}))},T=()=>{if(!s.username||s.username.length<3)return t({title:"Invalid username",description:"Username must be at least 3 characters",variant:"destructive"}),!1;if(!s.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email))return t({title:"Invalid email",description:"Please enter a valid email address",variant:"destructive"}),!1;const r=s.password||"";if(!/^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).{8,}$/.test(r)){const i="Password must be at least 8 characters and include an uppercase letter, a number and a special character";return j(i),t({title:"Weak password",description:i,variant:"destructive"}),!1}return j(null),s.password!==s.confirm?(t({title:"Passwords do not match",description:"Please confirm your password",variant:"destructive"}),!1):!0},$=async r=>{if(r==null||r.preventDefault(),!!T()){o(!0);try{localStorage.setItem(V,JSON.stringify({username:s.username,email:s.email}));try{sessionStorage.setItem("pending_password",s.password)}catch{}const{error:l}=await h(s.email,s.password,s.username);if(l){t({title:"Registration failed",description:l.message||"Unable to register",variant:"destructive"}),o(!1);return}k(!0),t({title:"Verification Sent",description:"Check your email and click the verification link."})}catch(l){console.error("Register error",l),t({title:"Registration failed",description:"Unexpected error",variant:"destructive"})}finally{o(!1)}}};return C?e.jsxDEV(Z,{email:s.email,onManualSignIn:()=>m("/login"),attemptAutoSignIn:async()=>{const r=sessionStorage.getItem("pending_password");if(!r)return!1;const l=await u(s.email,r);if(!(l!=null&&l.error)){try{sessionStorage.removeItem("pending_password")}catch(i){console.error("clear pending_password failed",i)}try{localStorage.removeItem(V)}catch(i){console.error("clear pending_profile failed",i)}return m("/dashboard"),!0}return!1}},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:103,columnNumber:7},void 0):e.jsxDEV("div",{className:"min-h-screen bg-gradient-to-br from-background to-secondary flex items-center justify-center p-4",children:e.jsxDEV("div",{className:"w-full max-w-md",children:[e.jsxDEV("div",{className:"text-center mb-6",children:[e.jsxDEV("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-primary to-primary-light rounded-full flex items-center justify-center mb-2",children:e.jsxDEV(O,{className:"h-8 w-8 text-primary-foreground"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:128,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:127,columnNumber:11},void 0),e.jsxDEV("h1",{className:"text-2xl font-bold",children:"FarmersBracket"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:130,columnNumber:11},void 0),e.jsxDEV("p",{className:"text-muted-foreground",children:"Create an account"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:131,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:126,columnNumber:9},void 0),e.jsxDEV(w,{children:[e.jsxDEV(y,{children:[e.jsxDEV(S,{children:"Create an account"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:136,columnNumber:13},void 0),e.jsxDEV(P,{children:"Signup — verify by email to continue"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:137,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:135,columnNumber:11},void 0),e.jsxDEV(I,{children:[e.jsxDEV("form",{onSubmit:$,className:"space-y-4",children:[e.jsxDEV("div",{children:[e.jsxDEV(b,{htmlFor:"username",children:"Username"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:142,columnNumber:17},void 0),e.jsxDEV(x,{id:"username",name:"username",value:s.username,onChange:N,className:"h-11"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:143,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:141,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(b,{htmlFor:"email",children:"Email"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:146,columnNumber:17},void 0),e.jsxDEV(x,{id:"email",name:"email",type:"email",value:s.email,onChange:N,className:"h-11"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:147,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:145,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(b,{htmlFor:"password",children:"Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:150,columnNumber:17},void 0),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(x,{id:"password",name:"password",type:g?"text":"password",value:s.password,onChange:N,className:"h-11 pr-10"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:152,columnNumber:19},void 0),e.jsxDEV("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-primary",onClick:()=>L(r=>!r),"aria-label":g?"Hide password":"Show password",children:g?e.jsxDEV(q,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:154,columnNumber:37},void 0):e.jsxDEV(W,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:154,columnNumber:70},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:153,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:151,columnNumber:17},void 0),R&&e.jsxDEV("p",{className:"text-xs text-red-600 mt-1",children:R},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:157,columnNumber:35},void 0),e.jsxDEV("div",{className:"mt-2 text-sm","aria-live":"polite",children:e.jsxDEV("ul",{className:"space-y-1",children:[e.jsxDEV("li",{className:"flex items-center gap-2",children:[a.length?e.jsxDEV(D,{className:"w-4 h-4 text-green-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:163,columnNumber:42},void 0):e.jsxDEV(p,{className:"w-4 h-4 text-red-500"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:163,columnNumber:89},void 0),e.jsxDEV("span",{className:a.length?"text-sm text-green-600":"text-sm text-red-500",children:"At least 8 characters"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:164,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:162,columnNumber:21},void 0),e.jsxDEV("li",{className:"flex items-center gap-2",children:[a.uppercase?e.jsxDEV(D,{className:"w-4 h-4 text-green-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:167,columnNumber:45},void 0):e.jsxDEV(p,{className:"w-4 h-4 text-red-500"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:167,columnNumber:92},void 0),e.jsxDEV("span",{className:a.uppercase?"text-sm text-green-600":"text-sm text-red-500",children:"One uppercase letter (A–Z)"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:168,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:166,columnNumber:21},void 0),e.jsxDEV("li",{className:"flex items-center gap-2",children:[a.number?e.jsxDEV(D,{className:"w-4 h-4 text-green-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:171,columnNumber:42},void 0):e.jsxDEV(p,{className:"w-4 h-4 text-red-500"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:171,columnNumber:89},void 0),e.jsxDEV("span",{className:a.number?"text-sm text-green-600":"text-sm text-red-500",children:"One number (0–9)"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:172,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:170,columnNumber:21},void 0),e.jsxDEV("li",{className:"flex items-center gap-2",children:[a.special?e.jsxDEV(D,{className:"w-4 h-4 text-green-600"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:175,columnNumber:43},void 0):e.jsxDEV(p,{className:"w-4 h-4 text-red-500"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:175,columnNumber:90},void 0),e.jsxDEV("span",{className:a.special?"text-sm text-green-600":"text-sm text-red-500",children:"One special character (!@#$...)"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:176,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:174,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:161,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:160,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:149,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(b,{htmlFor:"confirm",children:"Confirm Password"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:182,columnNumber:17},void 0),e.jsxDEV(x,{id:"confirm",name:"confirm",type:g?"text":"password",value:s.confirm,onChange:N,className:"h-11"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:183,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:181,columnNumber:15},void 0),e.jsxDEV("div",{className:"flex gap-3",children:e.jsxDEV(_,{type:"submit",className:"flex-1",disabled:d||!E||!v,"aria-describedby":"register-password-hint",children:d?"Creating...":"Create account"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:187,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:186,columnNumber:15},void 0),!d&&(!E||!v)&&e.jsxDEV("p",{id:"register-password-hint",className:"text-xs text-muted-foreground mt-2",children:E?v?"":"Passwords must match":"Meet all password requirements"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:198,columnNumber:17},void 0),e.jsxDEV("div",{className:"sr-only","aria-live":"polite",children:`Password requirements met ${U} of 4. ${v?"Passwords match.":"Passwords do not match."}`},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:204,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:140,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-center text-sm mt-4",children:[e.jsxDEV("span",{className:"text-muted-foreground",children:"Already have an account? "},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:208,columnNumber:15},void 0),e.jsxDEV(A,{to:"/login",className:"text-primary hover:underline font-medium",children:"Sign in"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:209,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:207,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:139,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:134,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:125,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:124,columnNumber:5},void 0)},Z=({email:m,onManualSignIn:h,attemptAutoSignIn:u})=>{const[t,s]=n.useState("waiting");return n.useEffect(()=>{let c=0,d=!1;const o=async()=>{s("attempting");const k=await u();if(!d){if(k){s("signed_in");return}if(c+=1,c>=20){s("failed");return}setTimeout(o,3e3)}},C=setTimeout(o,3e3);return()=>{d=!0,clearTimeout(C)}},[u]),e.jsxDEV("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxDEV("div",{className:"w-full max-w-md",children:e.jsxDEV(w,{children:[e.jsxDEV(y,{children:[e.jsxDEV("div",{className:"mx-auto w-12 h-12 bg-gradient-to-br from-primary to-primary-light rounded-full flex items-center justify-center",children:e.jsxDEV(O,{className:"h-6 w-6 text-primary-foreground"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:258,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:257,columnNumber:13},void 0),e.jsxDEV(S,{className:"text-center",children:"Check your email"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:260,columnNumber:13},void 0),e.jsxDEV(P,{className:"text-center",children:["We've sent a verification link to ",m,". After verifying, this screen will attempt to sign you in automatically."]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:261,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:256,columnNumber:11},void 0),e.jsxDEV(I,{children:e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV("div",{className:"text-center",children:[t==="waiting"&&e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Waiting for verification..."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:266,columnNumber:42},void 0),t==="attempting"&&e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Attempting to sign you in automatically..."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:267,columnNumber:45},void 0),t==="signed_in"&&e.jsxDEV("p",{className:"text-sm text-green-600",children:"Signed in successfully. Redirecting..."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:268,columnNumber:44},void 0),t==="failed"&&e.jsxDEV("p",{className:"text-sm text-red-600",children:"Automatic sign-in failed. Please sign in manually."},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:269,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:265,columnNumber:15},void 0),e.jsxDEV(_,{onClick:h,className:"w-full",children:"Sign in manually"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:272,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-center text-sm",children:e.jsxDEV(A,{to:"/login",className:"text-primary",children:"Or go to login"},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:274,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:273,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:264,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:263,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:255,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:254,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dell/Desktop/verdant-village-store/src/pages/Register.tsx",lineNumber:253,columnNumber:5},void 0)};export{se as default};
